#!/usr/bin/env ruby
require 'fileutils'

def parse_options
  options = {}
  case ARGV[1]
  when '-t'
    options[:t] = ARGV[2]
  else
    options[:t] = 'pdf'
  end
  options
end

case ARGV[0]
when 'new'
  STDOUT.puts 'Creating new pub directory structure...'
  FileUtils.mkpath  'content/chapters'
  FileUtils.touch   'content/cover.md'
  FileUtils.touch   'content/preface.md'
  FileUtils.touch   'content/chapters/1.md'
  FileUtils.mkdir   'output'
  FileUtils.mkdir   'assets'
  FileUtils.cp_r(Dir.glob(File.join(File.expand_path(File.dirname(__FILE__)), 'assets', '*')),
                    File.join(Dir.pwd, 'assets'))
  STDOUT.puts Dir.glob('**/*')
  STDOUT.puts 'Your project is ready for content!'
when 'generate', 'gen'
  STDOUT.puts 'Generating PDF to output directory...'
  require 'my_ebook_pub'
  MyEbookPub.generate parse_options
  STDOUT.puts 'Your file is ready. See ./output/render.pdf'
else
  STDOUT.puts <<-EOF
Usage:
  pub new
  pub generate

  options:
    -t FILE TYPE. Default: pdf (also available, epub and mobi)
EOF
end
